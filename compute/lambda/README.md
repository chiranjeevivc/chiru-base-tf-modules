# AWS Lambda Terraform module

Terraform module which creates a lambda function on AWS.

These types of resources are supported:

* [Lambda function](https://www.terraform.io/docs/providers/aws/r/lambda_function.html)
* [Lambda permission ](https://www.terraform.io/docs/providers/aws/r/lambda_permission.html)



## Usage

```hcl
module "lambda" {

  source                = "git::https://attid@codecloud.web.att.com/scm/st_addco/addco-terraform-modules.git//compute/lambda?ref=feature/lambda-tf-module"
  create_lambda         = "${var.create_lambda}"
  iam_role              = "${module.iam_role.iam_role_arn}" #pull from module
  filename_list         = ["./lambda_function.zip"]
  function_name         = "${var.function_name}"
  handler_list          = "${var.handler_list}"
  runtime               = "${var.runtime}"
  subnet_ids            = "${var.subnet_ids}"
  security_group_ids    = "${var.security_group_ids}"
  tags                  = "${var.tags}"
  source_code_hash_list = ["${data.archive_file.archived_file.output_base64sha256}"]
}
```

## Examples

* [Basic lambda function]
(https://codecloud.web.att.com/projects/ST_ADDCO/repos/addco-terraform-live-macdev/browse/us-east-1/examples?at=refs%2Fheads%2Fsimple-lambda)


## Variables for s3 bucket
- `create_lambda` - boolean value to create a lambda function with local function file. Defaults to false
- `create_lambda_s3` - boolean value to create a lambda function with function file in s3. Defaults to false
- `filename_list` - (Optional) The path to the function's deployment package within the local filesystem. If defined, The s3_-prefixed options cannot be used. Type list.
- `s3_bucket` - (Optional) The S3 bucket location containing the function's deployment package. Conflicts with filename. This bucket must reside in the same AWS region where you are creating the Lambda function.
- `s3_key` - (Optional) The S3 key of an object containing the function's deployment package. Conflicts with filename.
- `s3_object_version` - (Optional) The object version containing the function's deployment package. Conflicts with filename.
- `function_name` - (Required) A unique name for your Lambda Function.
- `handler_list` - (Required) The function entrypoint in your code. Type list
- `role` - (Required) IAM role attached to the Lambda Function. This governs both who / what can invoke your Lambda Function, as well as what resources our Lambda Function has access to. See Lambda Permission Model for more details.
- `description` - (Optional) Description of what your Lambda Function does.
- `memory_size` - (Optional) Amount of memory in MB your Lambda Function can use at runtime. Defaults to 128. See Limits
- `runtime` - (Required) See Runtimes for valid values.
- `timeout` - (Optional) The amount of time your Lambda Function has to run in seconds. Defaults to 3. See Limits
- `vpc_config` - (Optional) Provide this to allow your function to access your VPC. Fields documented below. See Lambda in VPC
- `kms_key_arn` - (Optional) The ARN for the KMS encryption key.
- `source_code_hash_list` - (Optional) Used to trigger updates. Must be set to a base64-encoded SHA256 hash of the package file/  specified with either filename or s3_key. The usual way to set this is ${base64sha256(file("file.zip"))}, where "file.zip" is the local filename of the lambda function source archive. Type is a list
- `tags` - (Optional) A mapping of tags to assign to the object.
- `vpc_config` requires the following:
  - `subnet_ids` - (Required) A list of subnet IDs associated with the Lambda function.
  - `security_group_ids` - (Required) A list of security group IDs associated with the Lambda function.


## Variables for lambda permission

- `name_lambda_permission` - Name of lambda permissions (Required) Name of the Lambda function whose resource policy you are updating
- `principal` - (Required) The principal who is getting this permission. e.g. s3.amazonaws.com, an AWS account ID, or any valid AWS service principal such as events.amazonaws.com or sns.amazonaws.com.
- `action` - (Required) The AWS Lambda action you want to allow in this statement. (e.g. lambda:InvokeFunction)
- `statement_id` - (Optional) A unique statement identifier. By default generated by Terraform.



## How it works & Other modules referenced

This module allows you to create a lambda function using either a local file or a file in a s3 bucket, which can be picked using a flag.
You can also creates a Lambda permission to allow external sources invoking the Lambda function (e.g. CloudWatch Event Rule, SNS or S3).

Other modules referenced
- `IAM` - creates the iam role that will be attached to the lambda function

Note: While using a local file, a data type called `data "archive_file"` should be used to zip the file to be used in the lambda function

Please refer to the s3 example to see how they should be used.
https://codecloud.web.att.com/projects/ST_ADDCO/repos/addco-terraform-live-macdev/browse/us-east-1/examples?at=refs%2Fheads%2Fsimple-lambda
